import{r as S,l as M,j as e,m as K,u as I,a as V,B as L,F as N,n as Q,c as q,e as Y,i as J,o as X,b as Z,p as z}from"./index-DAJnKZOv.js";import{u as _,w as ee,L as H,S as te,A as se,b as G,F as v,I as re}from"./xlsx-D-H_x7gl.js";import"./index-_W68fSk0.js";const P=S.forwardRef(({bsPrefix:u,bg:B="primary",pill:x=!1,text:i,className:f,as:d="span",...p},a)=>{const t=M(u,"badge");return e.jsx(d,{ref:a,...p,className:K(f,t,x&&"rounded-pill",i&&`text-${i}`,B&&`bg-${B}`)})});P.displayName="Badge";const ae=(u,B={})=>{try{const{fileName:x="poi-export",sourcePoint:i=null,searchInfo:f={},originalExcelData:d=null}=B,p=_.book_new(),a=_.aoa_to_sheet([]),t={HEADER_BG:{patternType:"solid",fgColor:{rgb:"4472C4"}},HEADER_FONT:{color:{rgb:"FFFFFF"}},CARD_BG:{patternType:"solid",fgColor:{rgb:"DDEBF7"}},CARD_LABEL_BG:{patternType:"solid",fgColor:{rgb:"5B9BD5"}},CARD_LABEL_FONT:{color:{rgb:"FFFFFF"}},CARD_VALUE_FONT:{color:{rgb:"2F528F"}},TABLE_HEADER_BG:{patternType:"solid",fgColor:{rgb:"5B9BD5"}},TABLE_HEADER_FONT:{color:{rgb:"FFFFFF"}},ROW_ALT_BG:{patternType:"solid",fgColor:{rgb:"EBF1F8"}},BORDER:{style:"thin",color:{rgb:"B4C6E7"}}};a["!styles"]={};const F=(r,o,A)=>{r[o]||(r[o]={t:"s",v:""}),r["!styles"]||(r["!styles"]={}),r["!styles"][o]||(r["!styles"][o]={}),Object.assign(r["!styles"][o],A),r[o].s||(r[o].s={}),Object.assign(r[o].s,A)},m=(r,o)=>{F(a,r,o)},T=(r,o,A,y)=>{for(let l=r;l<=o;l++)for(let n=A;n<=y;n++){const h=_.encode_cell({r:l,c:n});m(h,{border:{top:t.BORDER,bottom:t.BORDER,left:t.BORDER,right:t.BORDER}})}},g=(r,o,A,y,l)=>{for(let n=r;n<=o;n++)for(let h=A;h<=y;h++){const E=_.encode_cell({r:n,c:h});m(E,{fill:l})}};let s=0;a.A1={t:"s",v:"POI Search Results"},a["!merges"]=[{s:{r:0,c:0},e:{r:0,c:8}}],m("A1",{fill:t.HEADER_BG,font:{...t.HEADER_FONT,bold:!0,sz:16},alignment:{horizontal:"center",vertical:"center"}}),s++,s++;const O=s;i&&(a[`A${s}`]={t:"s",v:"Search Location:"},m(`A${s}`,{fill:t.CARD_LABEL_BG,font:{...t.CARD_LABEL_FONT,bold:!0},alignment:{horizontal:"right",vertical:"center"}}),a[`B${s}`]={t:"s",v:i.name||"Custom Location"},m(`B${s}`,{fill:t.CARD_BG,font:{...t.CARD_VALUE_FONT,bold:!0},alignment:{horizontal:"left",vertical:"center"}}),s++,a[`A${s}`]={t:"s",v:"Coordinates:"},m(`A${s}`,{fill:t.CARD_LABEL_BG,font:t.CARD_LABEL_FONT,alignment:{horizontal:"right",vertical:"center"}}),a[`B${s}`]={t:"s",v:`${i.latitude||i.lat}, ${i.longitude||i.lng}`},m(`B${s}`,{fill:t.CARD_BG,font:t.CARD_VALUE_FONT,alignment:{horizontal:"left",vertical:"center"}}),s++),f.radius&&(a[`A${s}`]={t:"s",v:"Search Radius:"},m(`A${s}`,{fill:t.CARD_LABEL_BG,font:t.CARD_LABEL_FONT,alignment:{horizontal:"right",vertical:"center"}}),a[`B${s}`]={t:"n",v:f.radius},m(`B${s}`,{fill:t.CARD_BG,font:t.CARD_VALUE_FONT,alignment:{horizontal:"left",vertical:"center"},numFmt:'0" m"'}),s++),f.categories&&f.categories.length>0&&(a[`A${s}`]={t:"s",v:"Categories:"},m(`A${s}`,{fill:t.CARD_LABEL_BG,font:t.CARD_LABEL_FONT,alignment:{horizontal:"right",vertical:"center"}}),a[`B${s}`]={t:"s",v:f.categories.join(", ")},m(`B${s}`,{fill:t.CARD_BG,font:t.CARD_VALUE_FONT,alignment:{horizontal:"left",vertical:"center"}}),s++),a[`A${s}`]={t:"s",v:"Date & Time:"},m(`A${s}`,{fill:t.CARD_LABEL_BG,font:t.CARD_LABEL_FONT,alignment:{horizontal:"right",vertical:"center"}}),a[`B${s}`]={t:"s",v:new Date().toLocaleString()},m(`B${s}`,{fill:t.CARD_BG,font:t.CARD_VALUE_FONT,alignment:{horizontal:"left",vertical:"center"}}),s++,a[`A${s}`]={t:"s",v:"Results Count:"},m(`A${s}`,{fill:t.CARD_LABEL_BG,font:t.CARD_LABEL_FONT,alignment:{horizontal:"right",vertical:"center"}}),a[`B${s}`]={t:"n",v:u.length},m(`B${s}`,{fill:t.CARD_BG,font:{...t.CARD_VALUE_FONT,bold:!0},alignment:{horizontal:"left",vertical:"center"}}),s++;const D=s-1;T(O,D,0,1),g(O,D,2,8,t.CARD_BG),s++;const w=u.map((r,o)=>({No:o+1,Name:r.name||"Unnamed",Type:r.type,"Distance (m)":Math.round(r.distance),Latitude:r.lat,Longitude:r.lng,Address:r.tags.address||r.tags["addr:full"]||"",Phone:r.tags.phone||r.tags["contact:phone"]||"",Website:r.tags.website||r.tags["contact:website"]||""})),b=Object.keys(w[0]||{}),$=s;for(let r=0;r<b.length;r++){const o=_.encode_cell({r:s,c:r});a[o]={t:"s",v:b[r]},m(o,{fill:t.TABLE_HEADER_BG,font:{...t.TABLE_HEADER_FONT,bold:!0},alignment:{horizontal:"center",vertical:"center",wrapText:!0}})}s++,w.forEach((r,o)=>{const A=Object.values(r),y=o%2===1;for(let l=0;l<A.length;l++){const n=A[l],h=typeof n=="number"?"n":"s",E=_.encode_cell({r:s,c:l});a[E]={t:h,v:n};let j={alignment:{vertical:"center"}};y&&(j.fill=t.ROW_ALT_BG),l===0?j.alignment.horizontal="center":l===3?j.numFmt='0" m"':l===8&&(j.font={color:{rgb:"0563C1"},underline:!0}),m(E,j)}s++}),T($,s-1,0,b.length-1);const c=[{wch:5},{wch:30},{wch:15},{wch:15},{wch:12},{wch:12},{wch:30},{wch:15},{wch:25}];a["!cols"]=c,a["!ref"]=_.encode_range({s:{c:0,r:0},e:{c:b.length-1,r:s-1}}),_.book_append_sheet(p,a,"POIs");const R=[];if(i&&(R.push({Parameter:"Search Center",Value:i.name||"Custom Location"}),R.push({Parameter:"Latitude",Value:i.latitude||i.lat}),R.push({Parameter:"Longitude",Value:i.longitude||i.lng}),i&&typeof i=="object"&&Object.entries(i).forEach(([r,o])=>{["name","latitude","longitude","lat","lng"].includes(r)||R.push({Parameter:r.charAt(0).toUpperCase()+r.slice(1),Value:o})})),f.radius&&R.push({Parameter:"Search Radius (m)",Value:f.radius}),f.categories&&f.categories.length>0&&R.push({Parameter:"Search Categories",Value:f.categories.join(", ")}),R.push({Parameter:"Export Time",Value:new Date().toLocaleString()}),R.length>0){const r=_.json_to_sheet(R);r["!cols"]=[{wch:20},{wch:40}];const o=r;F(o,"A1",{fill:t.TABLE_HEADER_BG,font:{...t.TABLE_HEADER_FONT,bold:!0}}),F(o,"B1",{fill:t.TABLE_HEADER_BG,font:{...t.TABLE_HEADER_FONT,bold:!0}}),_.book_append_sheet(p,r,"Search Info")}if(d&&d.length>0){const r=_.json_to_sheet(d),o=r,A=Object.keys(d[0]||{});for(let y=0;y<A.length;y++){const l=_.encode_cell({r:0,c:y});F(o,l,{fill:t.TABLE_HEADER_BG,font:{...t.TABLE_HEADER_FONT,bold:!0}})}_.book_append_sheet(p,r,"Source Data")}const C=new Date().toISOString().replace(/[:.]/g,"-").substring(0,19),k=`${x}-${C}.xlsx`;return ee(p,k),k}catch(x){throw console.error("Error exporting to Excel:",x),x}},le=({results:u})=>{const{selectedPoi:B,setSelectedPoi:x,theme:i}=I(),{t:f}=V(),d=a=>{switch(a){case"Hospital":return"danger";case"School":return"success";case"University":return"purple";case"Park":return"success";case"Supermarket":return"warning";case"Station":return"primary";case"Bus Stop":return"info";case"Townhall":return"secondary";default:return"secondary"}},p=a=>{const t=a.toLowerCase().replace(/ /g,"_");return f(t)||a};return e.jsx(H,{style:{height:"100%",overflowY:"auto"},children:u.map(a=>e.jsx(H.Item,{action:!0,active:B&&B.id===a.id,onClick:()=>x(a),variant:i==="dark"?"dark":"light",style:{cursor:"pointer",borderLeft:B&&B.id===a.id?"4px solid #007bff":"4px solid transparent"},className:"d-flex justify-content-between align-items-start",children:e.jsxs("div",{className:"ms-2 me-auto",children:[e.jsx("div",{className:"fw-bold",children:a.name}),e.jsxs("div",{className:"d-flex align-items-center mt-1",children:[e.jsx(P,{bg:d(a.type),className:"me-2",children:p(a.type)}),e.jsxs("small",{children:[Math.round(a.distance),"m"]})]}),a.tags.address&&e.jsx("small",{className:"text-muted d-block mt-1",children:a.tags.address})]})},a.id))})},ce=()=>{const{theme:u,results:B,isLoading:x,error:i,rightSidebarCollapsed:f,selectedExcelPoint:d,nearbyPois:p,clearSelectedExcelPoint:a,selectedPoint:t,radius:F,selectedCategories:m,excelPoints:T}=I(),{t:g}=V(),[s,O]=S.useState(""),[D,w]=S.useState("all"),[b,$]=S.useState("distance"),c=d&&p.length>0?p:B,R=S.useMemo(()=>!c||c.length===0?[]:[...new Set(c.map(n=>n.type))].sort(),[c]),C=S.useMemo(()=>{if(!c||c.length===0)return[];let l=[...c];if(s.trim()!==""){const n=s.toLowerCase();l=l.filter(h=>h.name.toLowerCase().includes(n)||h.tags.address&&h.tags.address.toLowerCase().includes(n))}return D!=="all"&&(l=l.filter(n=>n.type===D)),b==="distance"?l.sort((n,h)=>n.distance-h.distance):b==="name"&&l.sort((n,h)=>n.name.localeCompare(h.name)),l},[c,s,D,b]),k=()=>{O(""),w("all"),$("distance")},r=()=>{if(c.length!==0)try{const l={fileName:d?`nearby-pois-${d.name}`:"poi-export",searchInfo:{radius:F,categories:m.map(h=>{const E=q.POI_CATEGORIES.find(j=>j.id===h);return E?E.label:h})}};if(d){if(l.sourcePoint={name:d.name,latitude:d.latitude,longitude:d.longitude,...d.properties},T&&T.length>0){const h=T.map(E=>{const j={Name:E.name,Latitude:E.latitude,Longitude:E.longitude};return Object.entries(E.properties).forEach(([U,W])=>{j[U]=W}),j});l.originalExcelData=h}}else t&&(l.sourcePoint={name:"Map Selection",lat:t[0],lng:t[1]});const n=ae(C.length>0?C:c,l);console.log("Exported to:",n)}catch(l){console.error("Error exporting to Excel:",l)}},o=()=>{a()},A=e.jsxs(e.Fragment,{children:[e.jsxs("h4",{style:{margin:0},children:[d&&p.length>0?"Nearby POIs":g("results"),c.length>0&&e.jsx(P,{bg:u==="dark"?"secondary":"primary",className:"ms-2",children:c.length})]}),e.jsxs(L,{variant:"success",size:"sm",disabled:c.length===0,onClick:r,"aria-label":"Export to Excel",style:{borderRadius:"4px"},children:[e.jsx(N,{icon:Q,className:"me-1"}),g("exportButton")]})]}),y=()=>{var l;return e.jsxs(e.Fragment,{children:[d&&p.length>0&&e.jsxs(se,{variant:u==="dark"?"dark":"info",className:"d-flex justify-content-between align-items-start mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"fw-bold d-flex align-items-center",children:[e.jsx(N,{icon:Y,className:"me-2"}),d.name]}),e.jsxs("div",{className:"small mt-1",children:["Showing nearby POIs within ",(l=p[0])==null?void 0:l.distance," meters"]})]}),e.jsx(L,{variant:"outline-secondary",size:"sm",onClick:o,style:{borderRadius:"4px"},children:"Clear"})]}),i&&e.jsx("div",{className:"alert alert-danger",role:"alert",children:g("errorFetchingPois")}),x&&e.jsx("div",{className:"text-center my-3",children:e.jsx("div",{className:"spinner-border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}),!x&&c.length>0&&e.jsx(G,{className:"mb-3",children:e.jsxs(G.Item,{eventKey:"0",children:[e.jsxs(G.Header,{children:[e.jsx(N,{icon:J,className:"me-2"}),g("filterResults")]}),e.jsxs(G.Body,{className:u==="dark"?"bg-dark text-light":"",children:[e.jsxs(v.Group,{className:"mb-3",children:[e.jsx(v.Label,{children:g("searchResults")}),e.jsxs(re,{children:[e.jsx(v.Control,{type:"text",placeholder:g("searchResults"),value:s,onChange:n=>O(n.target.value),style:{borderRadius:"4px 0 0 4px"}}),s&&e.jsx(L,{variant:u==="dark"?"dark":"light",onClick:()=>O(""),style:{borderRadius:"0"},children:e.jsx(N,{icon:X})}),e.jsx(L,{variant:u==="dark"?"dark":"primary",style:{borderRadius:"0 4px 4px 0"},children:e.jsx(N,{icon:Z})})]})]}),e.jsxs(v.Group,{className:"mb-3",children:[e.jsx(v.Label,{children:g("typeFilter")}),e.jsxs(v.Select,{value:D,onChange:n=>w(n.target.value),style:{borderRadius:"4px"},className:u==="dark"?"bg-dark text-light":"",children:[e.jsx("option",{value:"all",children:g("allTypes")}),R.map(n=>e.jsx("option",{value:n,children:n},n))]})]}),e.jsxs(v.Group,{className:"mb-3",children:[e.jsx(v.Label,{children:g("sortBy")}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(L,{variant:b==="distance"?"primary":u==="dark"?"dark":"light",size:"sm",onClick:()=>$("distance"),style:{flex:1,borderRadius:"4px"},children:[e.jsx(N,{icon:z,className:"me-1"}),g("sortByDistance")]}),e.jsxs(L,{variant:b==="name"?"primary":u==="dark"?"dark":"light",size:"sm",onClick:()=>$("name"),style:{flex:1,borderRadius:"4px"},children:[e.jsx(N,{icon:z,className:"me-1"}),g("sortByName")]})]})]}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx(L,{variant:u==="dark"?"outline-light":"outline-secondary",size:"sm",onClick:k,style:{borderRadius:"4px"},children:g("resetFilters")})})]})]})}),!x&&c.length>0&&C.length!==c.length&&e.jsx("div",{className:"text-muted mb-2",style:{fontSize:"0.85rem"},children:g("showingResults").replace("{{count}}",C.length).replace("{{total}}",c.length)}),!x&&c.length>0&&e.jsx(le,{results:C,theme:u}),!x&&c.length===0&&!i&&e.jsx("div",{className:"text-center text-muted my-4",children:e.jsx("p",{children:g("noResults")})}),!x&&c.length>0&&C.length===0&&e.jsxs("div",{className:"text-center text-muted my-4",children:[e.jsx("p",{children:"No results match your filters."}),e.jsx(L,{variant:"link",size:"sm",onClick:k,children:g("resetFilters")})]})]})};return e.jsx(te,{isCollapsed:f,position:"right",theme:u,headerContent:A,children:y()})};export{ce as default};
