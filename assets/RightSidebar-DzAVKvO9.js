import{r as O,l as q,j as e,m as Y,u as U,a as W,B as F,F as w,n as J,c as X,e as Z,i as ee,o as te,b as se,p as V}from"./index-XCMDDAFB.js";import{u as E,w as le,L as K,S as ae,A as re,b as o,F as p,I as ne}from"./xlsx-CmMH_I1w.js";import"./index-DwyV54eG.js";const z=O.forwardRef(({bsPrefix:d,bg:y="primary",pill:b=!1,text:h,className:f,as:u="span",...j},r)=>{const l=q(d,"badge");return e.jsx(u,{ref:r,...j,className:Y(f,l,b&&"rounded-pill",h&&`text-${h}`,y&&`bg-${y}`)})});z.displayName="Badge";const ie=(d,y={})=>{try{const{fileName:b="poi-export",sourcePoint:h=null,searchInfo:f={},originalExcelData:u=null}=y,j=E.book_new(),r=E.aoa_to_sheet([]),l={HEADER_BG:{patternType:"solid",fgColor:{rgb:"4472C4"}},HEADER_FONT:{color:{rgb:"FFFFFF"}},CARD_BG:{patternType:"solid",fgColor:{rgb:"DDEBF7"}},CARD_LABEL_BG:{patternType:"solid",fgColor:{rgb:"5B9BD5"}},CARD_LABEL_FONT:{color:{rgb:"FFFFFF"}},CARD_VALUE_FONT:{color:{rgb:"2F528F"}},TABLE_HEADER_BG:{patternType:"solid",fgColor:{rgb:"5B9BD5"}},TABLE_HEADER_FONT:{color:{rgb:"FFFFFF"}},ROW_ALT_BG:{patternType:"solid",fgColor:{rgb:"EBF1F8"}},BORDER:{style:"thin",color:{rgb:"B4C6E7"}}};r["!styles"]={};const $=(s,n,_)=>{s[n]||(s[n]={t:"s",v:""}),s["!styles"]||(s["!styles"]={}),s["!styles"][n]||(s["!styles"][n]={}),Object.assign(s["!styles"][n],_),s[n].s||(s[n].s={}),Object.assign(s[n].s,_)},g=(s,n)=>{$(r,s,n)},S=(s,n,_,k)=>{for(let x=s;x<=n;x++)for(let R=_;R<=k;R++){const D=E.encode_cell({r:x,c:R});g(D,{border:{top:l.BORDER,bottom:l.BORDER,left:l.BORDER,right:l.BORDER}})}},i=(s,n,_,k,x)=>{for(let R=s;R<=n;R++)for(let D=_;D<=k;D++){const c=E.encode_cell({r:R,c:D});g(c,{fill:x})}};let a=0;r.A1={t:"s",v:"POI Search Results"},r["!merges"]=[{s:{r:0,c:0},e:{r:0,c:8}}],g("A1",{fill:l.HEADER_BG,font:{...l.HEADER_FONT,bold:!0,sz:16},alignment:{horizontal:"center",vertical:"center"}}),a++,a++;const G=a;h&&(r[`A${a}`]={t:"s",v:"Search Location:"},g(`A${a}`,{fill:l.CARD_LABEL_BG,font:{...l.CARD_LABEL_FONT,bold:!0},alignment:{horizontal:"right",vertical:"center"}}),r[`B${a}`]={t:"s",v:h.name||"Custom Location"},g(`B${a}`,{fill:l.CARD_BG,font:{...l.CARD_VALUE_FONT,bold:!0},alignment:{horizontal:"left",vertical:"center"}}),a++,r[`A${a}`]={t:"s",v:"Coordinates:"},g(`A${a}`,{fill:l.CARD_LABEL_BG,font:l.CARD_LABEL_FONT,alignment:{horizontal:"right",vertical:"center"}}),r[`B${a}`]={t:"s",v:`${h.latitude||h.lat}, ${h.longitude||h.lng}`},g(`B${a}`,{fill:l.CARD_BG,font:l.CARD_VALUE_FONT,alignment:{horizontal:"left",vertical:"center"}}),a++),f.radius&&(r[`A${a}`]={t:"s",v:"Search Radius:"},g(`A${a}`,{fill:l.CARD_LABEL_BG,font:l.CARD_LABEL_FONT,alignment:{horizontal:"right",vertical:"center"}}),r[`B${a}`]={t:"n",v:f.radius},g(`B${a}`,{fill:l.CARD_BG,font:l.CARD_VALUE_FONT,alignment:{horizontal:"left",vertical:"center"},numFmt:'0" m"'}),a++),f.categories&&f.categories.length>0&&(r[`A${a}`]={t:"s",v:"Categories:"},g(`A${a}`,{fill:l.CARD_LABEL_BG,font:l.CARD_LABEL_FONT,alignment:{horizontal:"right",vertical:"center"}}),r[`B${a}`]={t:"s",v:f.categories.join(", ")},g(`B${a}`,{fill:l.CARD_BG,font:l.CARD_VALUE_FONT,alignment:{horizontal:"left",vertical:"center"}}),a++),r[`A${a}`]={t:"s",v:"Date & Time:"},g(`A${a}`,{fill:l.CARD_LABEL_BG,font:l.CARD_LABEL_FONT,alignment:{horizontal:"right",vertical:"center"}}),r[`B${a}`]={t:"s",v:new Date().toLocaleString()},g(`B${a}`,{fill:l.CARD_BG,font:l.CARD_VALUE_FONT,alignment:{horizontal:"left",vertical:"center"}}),a++,r[`A${a}`]={t:"s",v:"Results Count:"},g(`A${a}`,{fill:l.CARD_LABEL_BG,font:l.CARD_LABEL_FONT,alignment:{horizontal:"right",vertical:"center"}}),r[`B${a}`]={t:"n",v:d.length},g(`B${a}`,{fill:l.CARD_BG,font:{...l.CARD_VALUE_FONT,bold:!0},alignment:{horizontal:"left",vertical:"center"}}),a++;const v=a-1;S(G,v,0,1),i(G,v,2,8,l.CARD_BG),a++;const P=d.map((s,n)=>({No:n+1,Name:s.name||"Unnamed",Type:s.type,"Distance (m)":Math.round(s.distance),Latitude:s.lat,Longitude:s.lng,Address:s.tags.address||s.tags["addr:full"]||"",Phone:s.tags.phone||s.tags["contact:phone"]||"",Website:s.tags.website||s.tags["contact:website"]||""})),L=Object.keys(P[0]||{}),H=a;for(let s=0;s<L.length;s++){const n=E.encode_cell({r:a,c:s});r[n]={t:"s",v:L[s]},g(n,{fill:l.TABLE_HEADER_BG,font:{...l.TABLE_HEADER_FONT,bold:!0},alignment:{horizontal:"center",vertical:"center",wrapText:!0}})}a++,P.forEach((s,n)=>{const _=Object.values(s),k=n%2===1;for(let x=0;x<_.length;x++){const R=_[x],D=typeof R=="number"?"n":"s",c=E.encode_cell({r:a,c:x});r[c]={t:D,v:R};let t={alignment:{vertical:"center"}};k&&(t.fill=l.ROW_ALT_BG),x===0?t.alignment.horizontal="center":x===3?t.numFmt='0" m"':x===8&&(t.font={color:{rgb:"0563C1"},underline:!0}),g(c,t)}a++}),S(H,a-1,0,L.length-1);const B=[{wch:5},{wch:30},{wch:15},{wch:15},{wch:12},{wch:12},{wch:30},{wch:15},{wch:25}];r["!cols"]=B,r["!ref"]=E.encode_range({s:{c:0,r:0},e:{c:L.length-1,r:a-1}}),E.book_append_sheet(j,r,"POIs");const C=[];if(h&&(C.push({Parameter:"Search Center",Value:h.name||"Custom Location"}),C.push({Parameter:"Latitude",Value:h.latitude||h.lat}),C.push({Parameter:"Longitude",Value:h.longitude||h.lng}),h&&typeof h=="object"&&Object.entries(h).forEach(([s,n])=>{["name","latitude","longitude","lat","lng"].includes(s)||C.push({Parameter:s.charAt(0).toUpperCase()+s.slice(1),Value:n})})),f.radius&&C.push({Parameter:"Search Radius (m)",Value:f.radius}),f.categories&&f.categories.length>0&&C.push({Parameter:"Search Categories",Value:f.categories.join(", ")}),C.push({Parameter:"Export Time",Value:new Date().toLocaleString()}),C.length>0){const s=E.json_to_sheet(C);s["!cols"]=[{wch:20},{wch:40}];const n=s;$(n,"A1",{fill:l.TABLE_HEADER_BG,font:{...l.TABLE_HEADER_FONT,bold:!0}}),$(n,"B1",{fill:l.TABLE_HEADER_BG,font:{...l.TABLE_HEADER_FONT,bold:!0}}),E.book_append_sheet(j,s,"Search Info")}if(u&&u.length>0){const s=E.json_to_sheet(u),n=s,_=Object.keys(u[0]||{});for(let k=0;k<_.length;k++){const x=E.encode_cell({r:0,c:k});$(n,x,{fill:l.TABLE_HEADER_BG,font:{...l.TABLE_HEADER_FONT,bold:!0}})}E.book_append_sheet(j,s,"Source Data")}const m=new Date().toISOString().replace(/[:.]/g,"-").substring(0,19),N=`${b}-${m}.xlsx`;return le(j,N),N}catch(b){throw console.error("Error exporting to Excel:",b),b}},ce=({results:d})=>{const{selectedPoi:y,setSelectedPoi:b,theme:h}=U(),{t:f}=W(),u=r=>{switch(r){case"Hospital":return"danger";case"School":return"success";case"University":return"purple";case"Park":return"success";case"Supermarket":return"warning";case"Station":return"primary";case"Bus Stop":return"info";case"Townhall":return"secondary";default:return"secondary"}},j=r=>{const l=r.toLowerCase().replace(/ /g,"_");return f(l)||r};return e.jsx(K,{style:{height:"100%",overflowY:"auto"},children:d.map(r=>e.jsx(K.Item,{action:!0,active:y&&y.id===r.id,onClick:()=>b(r),variant:h==="dark"?"dark":"light",style:{cursor:"pointer",borderLeft:y&&y.id===r.id?"4px solid #007bff":"4px solid transparent"},className:"d-flex justify-content-between align-items-start",children:e.jsxs("div",{className:"ms-2 me-auto",children:[e.jsx("div",{className:"fw-bold",children:r.name}),e.jsxs("div",{className:"d-flex align-items-center mt-1",children:[e.jsx(z,{bg:u(r.type),className:"me-2",children:j(r.type)}),e.jsxs("small",{children:[Math.round(r.distance),"m"]})]}),r.tags.address&&e.jsx("small",{className:"text-muted d-block mt-1",children:r.tags.address})]})},r.id))})},me=()=>{const{theme:d,results:y,isLoading:b,error:h,rightSidebarCollapsed:f,selectedExcelPoint:u,nearbyPois:j,clearSelectedExcelPoint:r,selectedPoint:l,radius:$,selectedCategories:g,excelPoints:S}=U(),{t:i}=W(),[a,G]=O.useState(""),[v,P]=O.useState("all"),[L,H]=O.useState("distance"),[B,C]=O.useState([]),m=u&&j.length>0?j:y,N=O.useMemo(()=>!m||m.length===0?[]:[...new Set(m.map(t=>t.type))].sort(),[m]),s=c=>{C(t=>t.includes(c)?t.filter(A=>A!==c):[...t,c]),P("custom")},n=O.useMemo(()=>{if(!m||m.length===0)return[];let c=[...m];if(a.trim()!==""){const t=a.toLowerCase();c=c.filter(A=>A.name.toLowerCase().includes(t)||A.tags.address&&A.tags.address.toLowerCase().includes(t))}return v==="all"||(v==="custom"&&B.length>0?c=c.filter(t=>B.includes(t.type)):v!=="all"&&v!=="custom"&&(c=c.filter(t=>t.type===v))),L==="distance"?c.sort((t,A)=>t.distance-A.distance):L==="name"&&c.sort((t,A)=>t.name.localeCompare(A.name)),c},[m,a,v,B,L]),_=()=>{G(""),P("all"),C([]),H("distance")},k=()=>{if(m.length!==0)try{const c={fileName:u?`nearby-pois-${u.name}`:"poi-export",searchInfo:{radius:$,categories:g.map(A=>{const T=X.POI_CATEGORIES.find(I=>I.id===A);return T?T.label:A})}};if(u){if(c.sourcePoint={name:u.name,latitude:u.latitude,longitude:u.longitude,...u.properties},S&&S.length>0){const A=S.map(T=>{const I={Name:T.name,Latitude:T.latitude,Longitude:T.longitude};return Object.entries(T.properties).forEach(([M,Q])=>{I[M]=Q}),I});c.originalExcelData=A}}else l&&(c.sourcePoint={name:"Map Selection",lat:l[0],lng:l[1]});const t=ie(n.length>0?n:m,c);console.log("Exported to:",t)}catch(c){console.error("Error exporting to Excel:",c)}},x=()=>{r()},R=e.jsxs(e.Fragment,{children:[e.jsxs("h4",{style:{margin:0},children:[u&&j.length>0?"Nearby POIs":i("results"),m.length>0&&e.jsx(z,{bg:d==="dark"?"secondary":"primary",className:"ms-2",children:m.length})]}),e.jsxs(F,{variant:"success",size:"sm",disabled:m.length===0,onClick:k,"aria-label":"Export to Excel",style:{borderRadius:"4px"},children:[e.jsx(w,{icon:J,className:"me-1"}),i("exportButton")]})]}),D=()=>{var c;return e.jsxs(e.Fragment,{children:[u&&j.length>0&&e.jsxs(re,{variant:d==="dark"?"dark":"info",className:"d-flex justify-content-between align-items-start mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"fw-bold d-flex align-items-center",children:[e.jsx(w,{icon:Z,className:"me-2"}),u.name]}),e.jsxs("div",{className:"small mt-1",children:["Showing nearby POIs within ",(c=j[0])==null?void 0:c.distance," meters"]})]}),e.jsx(F,{variant:"outline-secondary",size:"sm",onClick:x,style:{borderRadius:"4px"},children:"Clear"})]}),h&&e.jsx("div",{className:"alert alert-danger",role:"alert",children:i("errorFetchingPois")}),b&&e.jsx("div",{className:"text-center my-3",children:e.jsx("div",{className:"spinner-border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}),!b&&m.length>0&&e.jsx(o,{className:"mb-3",children:e.jsxs(o.Item,{eventKey:"0",children:[e.jsxs(o.Header,{children:[e.jsx(w,{icon:ee,className:"me-2"}),i("filterResults")]}),e.jsxs(o.Body,{className:d==="dark"?"bg-dark text-light":"",children:[e.jsxs(p.Group,{className:"mb-3",children:[e.jsx(p.Label,{children:i("searchResults")}),e.jsxs(ne,{children:[e.jsx(p.Control,{type:"text",placeholder:i("searchResults"),value:a,onChange:t=>G(t.target.value),style:{borderRadius:"4px 0 0 4px"}}),a&&e.jsx(F,{variant:d==="dark"?"dark":"light",onClick:()=>G(""),style:{borderRadius:"0"},children:e.jsx(w,{icon:te})}),e.jsx(F,{variant:d==="dark"?"dark":"primary",style:{borderRadius:"0 4px 4px 0"},children:e.jsx(w,{icon:se})})]})]}),e.jsxs(p.Group,{className:"mb-3",children:[e.jsx(p.Label,{children:i("typeFilter")}),e.jsxs(p.Select,{value:v,onChange:t=>{P(t.target.value),t.target.value==="all"&&C([])},style:{borderRadius:"4px",marginBottom:"10px"},className:d==="dark"?"bg-dark text-light":"",children:[e.jsx("option",{value:"all",children:i("allTypes")}),e.jsx("option",{value:"custom",children:i("customFilter")}),N.map(t=>e.jsx("option",{value:t,children:t},t))]}),v==="custom"&&e.jsxs(o,{className:"categories-accordion mb-2",children:[e.jsxs(o.Item,{eventKey:"essential",children:[e.jsx(o.Header,{children:e.jsx("span",{className:"small fw-medium",children:i("essentialServices")})}),e.jsx(o.Body,{className:`pt-2 pb-2 ${d==="dark"?"bg-dark text-light":""}`,children:["hospital","school","university","townhall","pharmacy","police","fire_station","post_office"].filter(t=>N.includes(t)).map(t=>e.jsx(p.Check,{type:"checkbox",id:`filter-${t}`,label:i(t),checked:B.includes(t),onChange:()=>s(t),className:"mb-1"},t))})]}),e.jsxs(o.Item,{eventKey:"food",children:[e.jsx(o.Header,{children:e.jsx("span",{className:"small fw-medium",children:i("foodAndDrink")})}),e.jsx(o.Body,{className:`pt-2 pb-2 ${d==="dark"?"bg-dark text-light":""}`,children:["restaurant","cafe","fast_food","pub","bar","bakery","supermarket"].filter(t=>N.includes(t)).map(t=>e.jsx(p.Check,{type:"checkbox",id:`filter-${t}`,label:i(t),checked:B.includes(t),onChange:()=>s(t),className:"mb-1"},t))})]}),e.jsxs(o.Item,{eventKey:"transport",children:[e.jsx(o.Header,{children:e.jsx("span",{className:"small fw-medium",children:i("transportation")})}),e.jsx(o.Body,{className:`pt-2 pb-2 ${d==="dark"?"bg-dark text-light":""}`,children:["station","bus_stop","taxi","parking","fuel"].filter(t=>N.includes(t)).map(t=>e.jsx(p.Check,{type:"checkbox",id:`filter-${t}`,label:i(t),checked:B.includes(t),onChange:()=>s(t),className:"mb-1"},t))})]}),e.jsxs(o.Item,{eventKey:"shopping",children:[e.jsx(o.Header,{children:e.jsx("span",{className:"small fw-medium",children:i("shopping")})}),e.jsx(o.Body,{className:`pt-2 pb-2 ${d==="dark"?"bg-dark text-light":""}`,children:["mall","convenience","clothes","electronics"].filter(t=>N.includes(t)).map(t=>e.jsx(p.Check,{type:"checkbox",id:`filter-${t}`,label:i(t),checked:B.includes(t),onChange:()=>s(t),className:"mb-1"},t))})]}),e.jsxs(o.Item,{eventKey:"healthcare",children:[e.jsx(o.Header,{children:e.jsx("span",{className:"small fw-medium",children:i("healthcare")})}),e.jsx(o.Body,{className:`pt-2 pb-2 ${d==="dark"?"bg-dark text-light":""}`,children:["doctors","dentist","clinic"].filter(t=>N.includes(t)).map(t=>e.jsx(p.Check,{type:"checkbox",id:`filter-${t}`,label:i(t),checked:B.includes(t),onChange:()=>s(t),className:"mb-1"},t))})]}),e.jsxs(o.Item,{eventKey:"recreation",children:[e.jsx(o.Header,{children:e.jsx("span",{className:"small fw-medium",children:i("recreationAndLeisure")})}),e.jsx(o.Body,{className:`pt-2 pb-2 ${d==="dark"?"bg-dark text-light":""}`,children:["park","sports_centre","stadium","swimming_pool","cinema","theatre","library","museum","gallery"].filter(t=>N.includes(t)).map(t=>e.jsx(p.Check,{type:"checkbox",id:`filter-${t}`,label:i(t),checked:B.includes(t),onChange:()=>s(t),className:"mb-1"},t))})]}),e.jsxs(o.Item,{eventKey:"accommodation",children:[e.jsx(o.Header,{children:e.jsx("span",{className:"small fw-medium",children:i("accommodation")})}),e.jsx(o.Body,{className:`pt-2 pb-2 ${d==="dark"?"bg-dark text-light":""}`,children:["hotel","hostel","guest_house"].filter(t=>N.includes(t)).map(t=>e.jsx(p.Check,{type:"checkbox",id:`filter-${t}`,label:i(t),checked:B.includes(t),onChange:()=>s(t),className:"mb-1"},t))})]}),e.jsxs(o.Item,{eventKey:"other",children:[e.jsx(o.Header,{children:e.jsx("span",{className:"small fw-medium",children:i("other")})}),e.jsx(o.Body,{className:`pt-2 pb-2 ${d==="dark"?"bg-dark text-light":""}`,children:["atm","bank","place_of_worship"].filter(t=>N.includes(t)).map(t=>e.jsx(p.Check,{type:"checkbox",id:`filter-${t}`,label:i(t),checked:B.includes(t),onChange:()=>s(t),className:"mb-1"},t))})]})]})]}),e.jsxs(p.Group,{className:"mb-3",children:[e.jsx(p.Label,{children:i("sortBy")}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(F,{variant:L==="distance"?"primary":d==="dark"?"dark":"light",size:"sm",onClick:()=>H("distance"),style:{flex:1,borderRadius:"4px"},children:[e.jsx(w,{icon:V,className:"me-1"}),i("sortByDistance")]}),e.jsxs(F,{variant:L==="name"?"primary":d==="dark"?"dark":"light",size:"sm",onClick:()=>H("name"),style:{flex:1,borderRadius:"4px"},children:[e.jsx(w,{icon:V,className:"me-1"}),i("sortByName")]})]})]}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx(F,{variant:d==="dark"?"outline-light":"outline-secondary",size:"sm",onClick:_,style:{borderRadius:"4px"},children:i("resetFilters")})})]})]})}),!b&&m.length>0&&n.length!==m.length&&e.jsx("div",{className:"text-muted mb-2",style:{fontSize:"0.85rem"},children:i("showingResults").replace("{{count}}",n.length).replace("{{total}}",m.length)}),!b&&m.length>0&&e.jsx(ce,{results:n,theme:d}),!b&&m.length===0&&!h&&e.jsx("div",{className:"text-center text-muted my-4",children:e.jsx("p",{children:i("noResults")})}),!b&&m.length>0&&n.length===0&&e.jsxs("div",{className:"text-center text-muted my-4",children:[e.jsx("p",{children:"No results match your filters."}),e.jsx(F,{variant:"link",size:"sm",onClick:_,children:i("resetFilters")})]})]})};return e.jsx(ae,{isCollapsed:f,position:"right",theme:d,headerContent:R,children:D()})};export{me as default};
