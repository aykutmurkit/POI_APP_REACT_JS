import{u as U,a as G,r as m,j as e,B as v,F as h,f as H,b as _,d as D,e as te,h as le,i as ne,c as ie,k as re}from"./index-XCMDDAFB.js";import{s as ce,f as de}from"./overpass-24MVlTyx.js";import{F as n,A as M,r as oe,u as he,S as me,I as O,a as z,L as A,b as t}from"./xlsx-CmMH_I1w.js";import"./index-DwyV54eG.js";const xe=()=>{const{theme:l,setExcelPoints:b}=U(),{t:k}=G(),[c,i]=m.useState(null),[E,y]=m.useState(!1),P=C=>{const f=C.target.files[0];if(!f)return;if(i(null),y(!1),!f.name.endsWith(".xlsx")&&!f.name.endsWith(".xls")){i("Please upload an Excel file (.xlsx or .xls)");return}const r=new FileReader;r.onload=B=>{try{const o=new Uint8Array(B.target.result),S=oe(o,{type:"array"}),F=S.SheetNames[0],L=S.Sheets[F],a=he.sheet_to_json(L);if(a.length===0){i("The Excel file is empty");return}const x=a[0];if(!("Boylam"in x)||!("Enlem"in x)||!("Name"in x)){i("Excel file must contain columns: Boylam, Enlem, and Name");return}const j=a.map(d=>({id:d["Durak Kodu"]||`point-${Math.random().toString(36).substr(2,9)}`,name:d.Name,latitude:parseFloat(d.Enlem),longitude:parseFloat(d.Boylam),properties:Object.keys(d).filter(p=>!["Boylam","Enlem","Name"].includes(p)).reduce((p,w)=>(p[w]=d[w],p),{})})),$=j.filter(d=>isNaN(d.latitude)||isNaN(d.longitude));if($.length>0){i(`Found ${$.length} points with invalid coordinates. Please check your data.`);return}b(j),y(!0),C.target.value=null}catch(o){console.error("Error reading Excel file:",o),i("Failed to read the Excel file. Please check the format and try again.")}},r.onerror=()=>{i("Error reading the file")},r.readAsArrayBuffer(f)};return e.jsxs("div",{className:"mb-3",children:[e.jsxs(n.Group,{controlId:"excelUpload",children:[e.jsx(n.Label,{className:l==="dark"?"text-light":"text-dark",children:k("uploadExcelFile")}),e.jsx(n.Control,{type:"file",accept:".xlsx, .xls",onChange:P,className:l==="dark"?"bg-dark text-light":""}),e.jsx(n.Text,{className:l==="dark"?"text-light":"text-dark",style:{fontWeight:"bold"},children:k("excelRequiredColumns")})]}),c&&e.jsx(M,{variant:"danger",className:"mt-2",children:c}),E&&e.jsx(M,{variant:"success",className:"mt-2",children:k("excelDataLoadedSuccess")})]})},ke=()=>{const{theme:l,radius:b,setRadius:k,selectedCategories:c,toggleCategory:i,setIsLoading:E,setError:y,setResults:P,setCenter:C,setSelectedPoint:f,selectedPoint:r,leftSidebarCollapsed:B,excelPoints:o,clearExcelPoints:S,selectedExcelPoint:F,selectExcelPoint:L}=U(),{t:a}=G(),[x,j]=m.useState(""),[$,d]=m.useState([]),[p,w]=m.useState(!1),[g,K]=m.useState("search"),[N,T]=m.useState(""),W=async()=>{if(x.trim()){w(!0);try{const s=await ce(x.trim());d(s)}catch(s){console.error("Error searching for location:",s)}finally{w(!1)}}},Q=async s=>{if(C([s.lat,s.lng]),f([s.lat,s.lng]),c.length>0){E(!0);try{const u=await de(c,[s.lat,s.lng],b);P(u),y(null)}catch(u){console.error("Error fetching POIs:",u),y("Failed to fetch POIs. Please try again."),P([])}finally{E(!1)}}d([]),j("")},q=()=>{r&&(d([]),j(`${r[0].toFixed(6)}, ${r[1].toFixed(6)}`))};m.useEffect(()=>{r&&j(`${r[0].toFixed(6)}, ${r[1].toFixed(6)}`)},[r]);const R=m.useMemo(()=>{if(!N.trim())return o;const s=N.toLowerCase();return o.filter(u=>{const Z=u.name.toLowerCase().includes(s),I=`${u.latitude}, ${u.longitude}`.includes(s),ee=Object.entries(u.properties||{}).some(([se,ae])=>se.toLowerCase().includes(s)||String(ae).toLowerCase().includes(s));return Z||I||ee})},[o,N]),V=e.jsxs("div",{className:"d-flex justify-content-between align-items-center w-100",children:[e.jsx("h4",{style:{margin:0},children:a(g==="search"?"appTitle":"excelPoints")}),g==="excel"&&e.jsx(v,{variant:"outline-danger",size:"sm",onClick:S,disabled:o.length===0,title:a("clearData"),style:{borderRadius:"4px"},children:e.jsx(h,{icon:H})})]}),Y=()=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx(n.Label,{children:a("locationSearch")}),e.jsxs(O,{className:"mb-2",children:[e.jsx(z,{placeholder:a("searchPlaceholder"),value:x,onChange:s=>j(s.target.value),disabled:p,"aria-label":a("searchPlaceholder")}),e.jsxs(v,{variant:l==="dark"?"dark":"primary",onClick:W,disabled:p||!x.trim(),"aria-label":a("searchButton"),style:{borderRadius:"4px"},children:[e.jsx(h,{icon:_})," ",a("searchButton")]})]}),r&&e.jsx("div",{className:"d-flex align-items-center mb-2",children:e.jsxs(v,{variant:l==="dark"?"outline-light":"outline-secondary",size:"sm",onClick:q,className:"w-100 d-flex align-items-center justify-content-center gap-2",style:{borderRadius:"4px"},children:[e.jsx(h,{icon:te}),e.jsx("span",{children:a("useSelectedPoint")}),e.jsxs("small",{className:"text-muted ms-1",children:["(",r[0].toFixed(4),", ",r[1].toFixed(4),")"]})]})}),$.length>0&&e.jsx(A,{className:"mt-2",children:$.map(s=>e.jsxs(A.Item,{action:!0,onClick:()=>Q(s),variant:l==="dark"?"dark":"light",className:"d-flex align-items-center",children:[e.jsx(h,{icon:le,className:"me-2"}),e.jsx("div",{className:"text-truncate",children:s.name})]},s.id))})]}),e.jsx(t,{defaultActiveKey:"0",children:e.jsxs(t.Item,{eventKey:"0",children:[e.jsxs(t.Header,{children:[e.jsx(h,{icon:ne,className:"me-2"}),a("filters")]}),e.jsxs(t.Body,{className:l==="dark"?"bg-dark text-light":"",children:[e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:a("radius")}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(n.Range,{min:100,max:5e3,step:100,value:b,onChange:s=>k(parseInt(s.target.value,10)),"aria-label":"Select radius"}),e.jsxs("span",{children:[b,"m"]})]}),e.jsx("div",{className:"d-flex justify-content-between mt-2",children:ie.AVAILABLE_RADIUS_OPTIONS.map(s=>e.jsxs(v,{size:"sm",variant:b===s?"primary":l==="dark"?"dark":"light",onClick:()=>k(s),style:{borderRadius:"4px"},children:[s,"m"]},s))})]}),e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:a("categories")}),e.jsxs(t,{className:"categories-accordion mb-2",children:[e.jsxs(t.Item,{eventKey:"essential",children:[e.jsx(t.Header,{children:e.jsx("span",{className:"small fw-medium",children:a("essentialServices")})}),e.jsx(t.Body,{className:`pt-2 pb-2 ${l==="dark"?"bg-dark text-light":""}`,children:["hospital","school","university","townhall","pharmacy","police","fire_station","post_office"].map(s=>e.jsx(n.Check,{type:"checkbox",id:`category-${s}`,label:a(s),checked:c.includes(s),onChange:()=>i(s),className:"mb-1"},s))})]}),e.jsxs(t.Item,{eventKey:"food",children:[e.jsx(t.Header,{children:e.jsx("span",{className:"small fw-medium",children:a("foodAndDrink")})}),e.jsx(t.Body,{className:`pt-2 pb-2 ${l==="dark"?"bg-dark text-light":""}`,children:["restaurant","cafe","fast_food","pub","bar","bakery","supermarket"].map(s=>e.jsx(n.Check,{type:"checkbox",id:`category-${s}`,label:a(s),checked:c.includes(s),onChange:()=>i(s),className:"mb-1"},s))})]}),e.jsxs(t.Item,{eventKey:"transport",children:[e.jsx(t.Header,{children:e.jsx("span",{className:"small fw-medium",children:a("transportation")})}),e.jsx(t.Body,{className:`pt-2 pb-2 ${l==="dark"?"bg-dark text-light":""}`,children:["station","bus_stop","taxi","parking","fuel"].map(s=>e.jsx(n.Check,{type:"checkbox",id:`category-${s}`,label:a(s),checked:c.includes(s),onChange:()=>i(s),className:"mb-1"},s))})]}),e.jsxs(t.Item,{eventKey:"shopping",children:[e.jsx(t.Header,{children:e.jsx("span",{className:"small fw-medium",children:a("shopping")})}),e.jsx(t.Body,{className:`pt-2 pb-2 ${l==="dark"?"bg-dark text-light":""}`,children:["mall","convenience","clothes","electronics"].map(s=>e.jsx(n.Check,{type:"checkbox",id:`category-${s}`,label:a(s),checked:c.includes(s),onChange:()=>i(s),className:"mb-1"},s))})]}),e.jsxs(t.Item,{eventKey:"healthcare",children:[e.jsx(t.Header,{children:e.jsx("span",{className:"small fw-medium",children:a("healthcare")})}),e.jsx(t.Body,{className:`pt-2 pb-2 ${l==="dark"?"bg-dark text-light":""}`,children:["doctors","dentist","clinic"].map(s=>e.jsx(n.Check,{type:"checkbox",id:`category-${s}`,label:a(s),checked:c.includes(s),onChange:()=>i(s),className:"mb-1"},s))})]}),e.jsxs(t.Item,{eventKey:"recreation",children:[e.jsx(t.Header,{children:e.jsx("span",{className:"small fw-medium",children:a("recreationAndLeisure")})}),e.jsx(t.Body,{className:`pt-2 pb-2 ${l==="dark"?"bg-dark text-light":""}`,children:["park","sports_centre","stadium","swimming_pool","cinema","theatre","library","museum","gallery"].map(s=>e.jsx(n.Check,{type:"checkbox",id:`category-${s}`,label:a(s),checked:c.includes(s),onChange:()=>i(s),className:"mb-1"},s))})]}),e.jsxs(t.Item,{eventKey:"accommodation",children:[e.jsx(t.Header,{children:e.jsx("span",{className:"small fw-medium",children:a("accommodation")})}),e.jsx(t.Body,{className:`pt-2 pb-2 ${l==="dark"?"bg-dark text-light":""}`,children:["hotel","hostel","guest_house"].map(s=>e.jsx(n.Check,{type:"checkbox",id:`category-${s}`,label:a(s),checked:c.includes(s),onChange:()=>i(s),className:"mb-1"},s))})]}),e.jsxs(t.Item,{eventKey:"other",children:[e.jsx(t.Header,{children:e.jsx("span",{className:"small fw-medium",children:a("other")})}),e.jsx(t.Body,{className:`pt-2 pb-2 ${l==="dark"?"bg-dark text-light":""}`,children:["atm","bank","place_of_worship"].map(s=>e.jsx(n.Check,{type:"checkbox",id:`category-${s}`,label:a(s),checked:c.includes(s),onChange:()=>i(s),className:"mb-1"},s))})]})]})]})]})]})})]}),J=()=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h5",{className:`mb-0 ${l==="dark"?"text-light":"text-dark"}`,children:a("excelDataUpload")}),e.jsxs(v,{variant:"outline-danger",size:"sm",onClick:S,disabled:o.length===0,title:a("clearData"),children:[e.jsx(h,{icon:H,className:"me-1"}),a("clearData")]})]}),e.jsx(xe,{}),o.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("h5",{className:l==="dark"?"text-light":"text-dark",children:a("loadedPoints",{count:o.length})}),e.jsx("div",{className:`mb-2 ${l==="dark"?"text-light":"text-dark"}`,style:{fontWeight:"bold"},children:a("pointsAddedToMap")}),e.jsx(t,{children:e.jsxs(t.Item,{eventKey:"0",children:[e.jsxs(t.Header,{children:[e.jsx(h,{icon:D,className:"me-2"}),a("viewPointList")]}),e.jsxs(t.Body,{className:`${l==="dark"?"bg-dark text-light":""} p-2`,style:{maxHeight:"300px",overflowY:"auto"},children:[e.jsxs(O,{className:"mb-2",children:[e.jsx(z,{placeholder:a("searchPointsPlaceholder"),value:N,onChange:s=>T(s.target.value),size:"sm","aria-label":a("filterPoints")}),N&&e.jsx(v,{variant:l==="dark"?"dark":"light",onClick:()=>T(""),size:"sm",children:e.jsx(h,{icon:re})})]}),N&&e.jsx("div",{className:"small mb-2 text-muted",children:a("showingResults",{count:R.length,total:o.length})}),e.jsxs(A,{variant:l==="dark"?"dark":"light",className:"point-list",children:[R.map(s=>e.jsxs(A.Item,{action:!0,className:`small py-2 px-3 ${l==="dark"?"bg-dark text-light border-secondary":""} ${F&&F.id===s.id?"active":""}`,onClick:()=>{C([s.latitude,s.longitude]),L(s.id)},children:[e.jsx("div",{className:"fw-bold",children:s.name}),e.jsxs("div",{className:`small ${l==="dark"?"text-light":"text-muted"}`,children:[s.latitude.toFixed(6),", ",s.longitude.toFixed(6)]})]},s.id)),R.length===0&&e.jsxs("div",{className:"text-center py-3 text-muted",children:[e.jsx(h,{icon:_,className:"me-2"}),a("noMatchingPoints")]})]})]})]})})]})]}),X=()=>e.jsxs("div",{children:[e.jsx("div",{className:"nav-tabs-container mb-3",children:e.jsxs("ul",{className:"nav nav-tabs",children:[e.jsx("li",{className:"nav-item",children:e.jsxs("button",{className:`nav-link ${g==="search"?"active":""}`,onClick:()=>K("search"),children:[e.jsx(h,{icon:_,className:"me-2"}),"Search"]})}),e.jsx("li",{className:"nav-item",children:e.jsxs("button",{className:`nav-link ${g==="excel"?"active":""}`,onClick:()=>K("excel"),children:[e.jsx(h,{icon:D,className:"me-2"}),"Excel"]})})]})}),e.jsxs("div",{className:"tab-content",children:[e.jsx("div",{className:`tab-pane ${g==="search"?"active":""}`,children:Y()}),e.jsx("div",{className:`tab-pane ${g==="excel"?"active":""}`,children:J()})]})]});return e.jsx(me,{isCollapsed:B,position:"left",theme:l,headerContent:V,children:X()})};export{ke as default};
